{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Shareholders{% endblock %}

{% block extra_css %}
<style>
    @media print {
        body * {
            visibility: hidden;
        }
        .print-section, .print-section * {
            visibility: visible;
        }
        .print-section {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            background: white;
            padding: 20px;
        }
        .no-print {
            display: none !important;
        }
    }
    
    .shareholder-photo-print {
        width: 150px;
        height: 180px;
        border: 1px solid #ddd;
        margin-bottom: 10px;
        object-fit: cover;
    }
    
    .shareholder-details-print {
        margin-top: 20px;
    }
    
    .shareholder-details-print .row {
        margin-bottom: 5px;
        padding-bottom: 5px;
        border-bottom: 1px solid #eee;
    }
    
    .shareholder-details-print .label {
        font-weight: bold;
        color: #666;
    }
    
    .summary-card {
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        color: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
    }
    .summary-card:hover {
        transform: translateY(-5px);
    }
    .card-1 { background: linear-gradient(45deg, #4e73df, #224abe); }
    .card-2 { background: linear-gradient(45deg, #1cc88a, #13855c); }
    .card-3 { background: linear-gradient(45deg, #36b9cc, #258391); }
    .card-4 { background: linear-gradient(45deg, #f6c23e, #dda20a); }
    .summary-icon {
        font-size: 2.5rem;
        opacity: 0.8;
    }
    .table-responsive {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        padding: 20px;
    }
    .search-box {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .action-buttons .btn {
        margin-right: 8px;
        margin-bottom: 8px;
    }
    .shareholder-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
        object-fit: cover;
    }
    .status-badge {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .status-active { background-color: #d1e7dd; color: #0f5132; }
    .status-inactive { background-color: #f8d7da; color: #842029; }
    .status-pending { background-color: #fff3cd; color: #664d03; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="mb-0">Shareholders</h3>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addShareholderModal">
            <i class="fas fa-user-plus me-2"></i>Add Shareholder
        </button>
    </div>

    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="summary-card card-1">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-1">Total Shareholders</h6>
                        <h3 class="mb-0">{{ shareholders|length }}</h3>
                    </div>
                    <i class="fas fa-users summary-icon"></i>
                </div>
                <div class="mt-3 text-sm">
                    <span class="me-2"><i class="fas fa-arrow-up"></i> 12.5%</span>
                    <span>Since last quarter</span>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="summary-card card-2">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-1">Active Shareholders</h6>
                        <h3 class="mb-0">{% widthratio shareholders|length 1 0.85 %}</h3>
                    </div>
                    <i class="fas fa-user-check summary-icon"></i>
                </div>
                <div class="mt-3 text-sm">
                    <span class="me-2"><i class="fas fa-arrow-up"></i> 8.2%</span>
                    <span>Since last quarter</span>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="summary-card card-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-1">Total Shares</h6>
                        <h3 class="mb-0">1,250,000</h3>
                    </div>
                    <i class="fas fa-chart-pie summary-icon"></i>
                </div>
                <div class="mt-3 text-sm">
                    <span class="me-2"><i class="fas fa-arrow-up"></i> 5.3%</span>
                    <span>Since last quarter</span>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="summary-card card-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-1">Avg. Shares/Investor</h6>
                        <h3 class="mb-0">{{ "5000"|floatformat:0 }}</h3>
                    </div>
                    <i class="fas fa-chart-line summary-icon"></i>
                </div>
                <div class="mt-3 text-sm">
                    <span class="me-2"><i class="fas fa-arrow-up"></i> 3.1%</span>
                    <span>Since last quarter</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-box">
        <div class="row">
            <div class="col-md-8">
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control" placeholder="Search shareholders by name, ID, or contact..." id="shareholderSearch">
                    <button class="btn btn-outline-secondary" type="button" id="searchButton">Search</button>
                </div>
            </div>
            <div class="col-md-4">
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-filter"></i></span>
                    <select class="form-select" id="statusFilter">
                        <option value="" selected>All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="pending">Pending Approval</option>
                    </select>
                    <button class="btn btn-outline-secondary" type="button" id="filterButton">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Shareholders Table -->
    <div class="table-responsive">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Shareholder Directory</h5>
            <div class="action-buttons">
                <button class="btn btn-sm btn-outline-secondary" id="exportButton">
                    <i class="fas fa-download me-1"></i> Export
                </button>
                <button class="btn btn-sm btn-outline-secondary" id="printButton">
                    <i class="fas fa-print me-1"></i> Print
                </button>
            </div>
        </div>
        
        <div class="table-responsive">
            <table class="table table-hover align-middle" id="shareholdersTable">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Shareholder</th>
                        <th>ID/Passport</th>
                        <th>Shares</th>
                        <th>Ownership %</th>
                        <th>Contact</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for shareholder in shareholders %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="{% static 'dashboard/ipi_logo.png' %}" alt="Shareholder" class="shareholder-avatar">
                                <div>
                                    <div class="fw-bold">{{ shareholder.full_name }}</div>
                                    <small class="text-muted">{{ shareholder.company.name|default:"Individual" }}</small>
                                </div>
                            </div>
                        </td>
                        <td>{{ shareholder.id_number|default:"N/A" }}</td>
                        <td>{{ shareholder.total_shares|default:0|floatformat:0 }}</td>
                        <td>{% widthratio shareholder.total_shares 1250000 100 %}%</td>
                        <td>
                            <div class="text-nowrap">
                                <div><i class="fas fa-envelope me-1 text-muted"></i> {{ shareholder.email|default:"N/A" }}</div>
                                <div><i class="fas fa-phone me-1 text-muted"></i> {{ shareholder.phone|default:"N/A" }}</div>
                            </div>
                        </td>
                        <td>
                            {% if shareholder.is_active %}
                                <span class="status-badge status-active">Active</span>
                            {% else %}
                                <span class="status-badge status-inactive">Inactive</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-primary" title="View Details" 
                                        onclick="viewShareholder({{ shareholder.id }})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" title="Edit"
                                        onclick="editShareholder({{ shareholder.id }})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" title="Deactivate"
                                        onclick="confirmDeactivate({{ shareholder.id }})">
                                    <i class="fas fa-user-times"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="text-center py-4">
                            <div class="text-muted">
                                <i class="fas fa-users fa-2x mb-2"></i>
                                <p class="mb-0">No shareholders found. Click 'Add Shareholder' to get started.</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {% if shareholders.has_other_pages %}
        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center">
                {% if shareholders.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ shareholders.previous_page_number }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link" aria-hidden="true">&laquo;</span>
                </li>
                {% endif %}

                {% for i in shareholders.paginator.page_range %}
                    {% if shareholders.number == i %}
                    <li class="page-item active"><span class="page-link">{{ i }}</span></li>
                    {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                    {% endif %}
                {% endfor %}

                {% if shareholders.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ shareholders.next_page_number }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link" aria-hidden="true">&raquo;</span>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
    </div>
</div>

<!-- Add Shareholder Modal -->
<div class="modal fade" id="addShareholderModal" tabindex="-1" aria-labelledby="addShareholderModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="modal-title mb-0" id="addShareholderModalLabel">Shareholder Management</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="addShareholderForm" method="post" action="{% url 'dashboard:shareholders' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-body">
                    <!-- Search Section -->
                    <div class="collapse mb-4" id="searchSection">
                        <div class="card card-body">
                            <div class="input-group">
                                <input type="text" class="form-control" id="searchShareholderId" placeholder="Enter ID/Passport Number">
                                <button class="btn btn-primary" type="button" id="searchShareholderBtn">
                                    <i class="fas fa-search me-1"></i> Search
                                </button>
                            </div>
                            <div id="searchResults" class="mt-2"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <div class="mb-3">
                                <div class="position-relative d-inline-block">
                                    <img id="shareholderPhotoPreview" src="{% static 'shareholders/images/default-avatar.png' %}" 
                                         class="rounded-circle" width="150" height="150" 
                                         style="object-fit: cover; border: 3px solid #e9ecef; cursor: pointer;"
                                         onclick="document.getElementById('shareholderPhoto').click()">
                                    <div class="position-absolute bottom-0 end-0 bg-primary rounded-circle p-2" 
                                         style="cursor: pointer;"
                                         onclick="document.getElementById('shareholderPhoto').click()">
                                        <i class="fas fa-camera text-white"></i>
                                    </div>
                                </div>
                                <input type="file" class="d-none" id="shareholderPhoto" name="photo" accept="image/*">
                                <div class="form-text">Click to upload photo</div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="firstName" class="form-label">First Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="firstName" name="first_name" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="lastName" class="form-label">Last Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="lastName" name="last_name" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="idNumber" class="form-label">ID/Passport Number <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="idNumber" name="id_number" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="phone" class="form-label">Phone</label>
                                    <input type="tel" class="form-control" id="phone" name="phone">
                                </div>
                                <div class="col-md-6">
                                    <label for="sharesOwned" class="form-label">Shares Owned</label>
                                    <input type="number" class="form-control" id="sharesOwned" name="total_shares" min="0" value="0">
                                </div>
                                <div class="col-12">
                                    <label for="address" class="form-label">Address</label>
                                    <textarea class="form-control" id="address" name="address" rows="2"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="me-auto">
                        <button type="button" class="btn btn-outline-secondary" id="searchExistingBtn" data-bs-toggle="collapse" data-bs-target="#searchSection">
                            <i class="fas fa-search me-1"></i> Search Existing
                        </button>
                    </div>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-1"></i> Save Shareholder
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle custom ID field
        const useCustomId = document.getElementById('useCustomId');
        const idNumberField = document.getElementById('idNumber');
        const autoGeneratedId = "{{ auto_generated_id }}";

        // Initialize tooltips only if elements with title attribute exist
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'));
        if (tooltipTriggerList.length > 0) {
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        }

        // Toggle ID field editability if elements exist
        if (useCustomId && idNumberField) {
            useCustomId.addEventListener('change', function() {
                if (this.checked) {
                    idNumberField.readOnly = false;
                    idNumberField.value = '';
                    idNumberField.placeholder = 'Enter custom ID';
                    idNumberField.required = true;
                } else {
                    idNumberField.readOnly = true;
                    idNumberField.value = autoGeneratedId;
                    idNumberField.required = false;
                }
            });
        }

        // Search functionality - only initialize if elements exist
        const searchButton = document.getElementById('searchButton');
        const searchInput = document.getElementById('searchInput');

        if (searchButton && searchInput) {
            searchButton.addEventListener('click', searchShareholder);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchShareholder();
                }
            });
        }

        // Print functionality
        const printBtn = document.getElementById('printShareholderBtn');
        if (printBtn) {
            printBtn.addEventListener('click', printShareholder);
        }

        // Photo upload preview - only initialize if elements exist
        const photoInput = document.getElementById('shareholderPhoto');
        const photoPreview = document.getElementById('shareholderPhotoPreview');

        if (photoInput && photoPreview) {
            photoInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        photoPreview.src = e.target.result;
                        document.getElementById('shareholderPhotoPreview').src = e.target.result;
                    }
                    reader.readAsDataURL(file);
                }
            });
        }

        // Initialize tooltips
        // Tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Search functionality
        document.getElementById('searchButton').addEventListener('click', function() {
            const searchTerm = document.getElementById('shareholderSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#shareholdersTable tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Filter by status
        document.getElementById('filterButton').addEventListener('click', function() {
            const status = document.getElementById('statusFilter').value;
            const rows = document.querySelectorAll('#shareholdersTable tbody tr');
            
            rows.forEach(row => {
                if (status === '') {
                    row.style.display = '';
                    return;
                }
                
                const statusCell = row.querySelector('td:nth-child(7) .status-badge');
                if (statusCell) {
                    const rowStatus = statusCell.textContent.trim().toLowerCase();
                    row.style.display = rowStatus.includes(status) ? '' : 'none';
                }
            });
        });

        // Export functionality
        document.getElementById('exportButton').addEventListener('click', function() {
            // Implement export to CSV/Excel
            alert('Export functionality will be implemented here');
        });

        // Print functionality
        document.getElementById('printButton').addEventListener('click', function() {
            window.print();
        });

        // Save shareholder - only add event listener if element exists
        const saveButton = document.getElementById('saveShareholder');
        if (saveButton) {
            saveButton.addEventListener('click', function() {
                // Implement save functionality
                alert('Save functionality will be implemented here');
            });
        }
    });

    // Search for shareholder by ID
    async function searchShareholder() {
        const id = document.getElementById('searchShareholderId').value.trim();
        const resultsDiv = document.getElementById('searchResults');
        
        if (!id) {
            resultsDiv.innerHTML = '<div class="alert alert-warning">Please enter an ID/Passport number</div>';
            return;
        }

        try {
            // Show loading state
            resultsDiv.innerHTML = '<div class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>';
            
            // In a real application, you would make an API call here
            // const response = await fetch(`/api/shareholders/${id}/`);
            // const data = await response.json();
            
            // Simulated API response for demo
            setTimeout(() => {
                const mockData = {
                    id: id,
                    first_name: 'John',
                    last_name: 'Doe',
                    email: `john.doe@example.com`,
                    phone: '+1234567890',
                    id_number: id,
                    total_shares: 1000,
                    share_class: 'ordinary',
                    company: '1',
                    address: '123 Main St, City, Country',
                    photo_url: '{% static 'shareholders/images/default-avatar.png' %}',
                    status: 'active'
                };
                
                populateForm(mockData);
                resultsDiv.innerHTML = '<div class="alert alert-success">Shareholder found and details loaded</div>';
            }, 800);
            
        } catch (error) {
            console.error('Error searching for shareholder:', error);
            resultsDiv.innerHTML = '<div class="alert alert-danger">Error searching for shareholder. Please try again.</div>';
        }
    }

    // Populate form with shareholder data
    function populateForm(data) {
        if (!data) return;
        
        // Basic info
        if (data.first_name) document.getElementById('firstName').value = data.first_name;
        if (data.last_name) document.getElementById('lastName').value = data.last_name;
        if (data.id_number) document.getElementById('idNumber').value = data.id_number;
        if (data.email) document.getElementById('email').value = data.email;
        if (data.phone) document.getElementById('phone').value = data.phone;
        if (data.total_shares) document.getElementById('sharesOwned').value = data.total_shares;
        if (data.share_class) document.getElementById('shareClass').value = data.share_class;
        if (data.company) document.getElementById('company').value = data.company;
        if (data.address) document.getElementById('address').value = data.address;
        
        // Update photo if available
        if (data.photo_url) {
            document.getElementById('shareholderPhotoPreview').src = data.photo_url;
        }
        
        // Show success message
        const toast = new bootstrap.Toast(document.getElementById('searchResults'));
        toast.show();
    }

    // Print shareholder details
    function printShareholder() {
        // Get form data
        const firstName = document.getElementById('firstName').value || 'N/A';
        const lastName = document.getElementById('lastName').value || 'N/A';
        const idNumber = document.getElementById('idNumber').value || 'N/A';
        const email = document.getElementById('email').value || 'N/A';
        const phone = document.getElementById('phone').value || 'N/A';
        const sharesOwned = document.getElementById('sharesOwned').value || '0';
        const shareClass = document.getElementById('shareClass').value || 'N/A';
        const companySelect = document.getElementById('company');
        const company = companySelect.options[companySelect.selectedIndex].text || 'N/A';
        const address = document.getElementById('address').value || 'N/A';
        const photoSrc = document.getElementById('shareholderPhotoPreview').src;
        
        // Create print content
        const printContent = `
            <div class="print-section">
                <div class="text-center mb-4">
                    <h4>Shareholder Details</h4>
                    <p class="text-muted">Generated on ${new Date().toLocaleString()}</p>
                </div>
                
                <div class="row">
                    <div class="col-md-3 text-center">
                        <img src="${photoSrc}" class="shareholder-photo-print mb-2">
                        <div class="status-badge status-${sharesOwned > 0 ? 'active' : 'inactive'}">
                            ${sharesOwned > 0 ? 'Active' : 'Inactive'}
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div class="shareholder-details-print">
                            <div class="row">
                                <div class="col-3 label">Full Name:</div>
                                <div class="col-9">${firstName} ${lastName}</div>
                            </div>
                            <div class="row">
                                <div class="col-3 label">ID/Passport:</div>
                                <div class="col-9">${idNumber}</div>
                            </div>
                            <div class="row">
                                <div class="col-3 label">Email:</div>
                                <div class="col-9">${email}</div>
                            </div>
                            <div class="row">
                                <div class="col-3 label">Phone:</div>
                                <div class="col-9">${phone}</div>
                            </div>
                            <div class="row">
                                <div class="col-3 label">Shares Owned:</div>
                                <div class="col-9">${parseInt(sharesOwned).toLocaleString()}</div>
                            </div>
                            <div class="row">
                                <div class="col-3 label">Share Class:</div>
                                <div class="col-9">${shareClass.charAt(0).toUpperCase() + shareClass.slice(1)}</div>
                            </div>
                            <div class="row">
                                <div class="col-3 label">Company:</div>
                                <div class="col-9">${company}</div>
                            </div>
                            <div class="row">
                                <div class="col-3 label">Address:</div>
                                <div class="col-9">${address.replace(/\n/g, '<br>')}</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-5 pt-3 border-top text-muted text-center">
                    <small>This is a computer-generated document. No signature is required.</small>
                </div>
            </div>
        `;
        
        // Open print window
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Shareholder Details - ${firstName} ${lastName}</title>
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
                <style>
                    @page { size: A4; margin: 1cm; }
                    body { font-family: Arial, sans-serif; }
                    .print-section { max-width: 800px; margin: 0 auto; }
                    .shareholder-photo-print { width: 150px; height: 180px; object-fit: cover; border: 1px solid #ddd; }
                    .shareholder-details-print .row { margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #eee; }
                    .label { font-weight: bold; color: #666; }
                    .status-badge { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 0.8em; }
                    .status-active { background-color: #d1e7dd; color: #0f5132; }
                    .status-inactive { background-color: #f8d7da; color: #842029; }
                </style>
            </head>
            <body>
                ${printContent}
                <script>
                    window.onload = function() {
                        window.print();
                        setTimeout(function() { window.close(); }, 100);
                    };
                <\/script>
            </body>
            </html>
        `);
        printWindow.document.close();
    }

    // View shareholder details
    function viewShareholder(id) {
        // In a real application, you would fetch the shareholder details
        console.log('View shareholder:', id);
        // For demo, we'll just show the print preview
        printShareholder();
    }

    // Edit shareholder
    function editShareholder(id) {
        // Implement edit functionality
        alert('Editing shareholder with ID: ' + id);
    }

    // Confirm deactivation
    function confirmDeactivate(id) {
        if (confirm('Are you sure you want to deactivate this shareholder? This action cannot be undone.')) {
            // Implement deactivation
            alert('Deactivating shareholder with ID: ' + id);
        }
    }
</script>
{% endblock %}
